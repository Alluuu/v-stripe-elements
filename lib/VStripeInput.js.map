{"version":3,"sources":["../src/VStripeInput.ts"],"names":[],"mappings":"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","sourcesContent":["// Styles\nimport './VStripeInput.sass'\n// Extensions and Components\nimport { VTextField } from 'vuetify/lib'\n// import { VNode, CreateElement } from 'vue'\n\n// Vuetify Types\n// import 'vuetify/types'\n\n// import { VTextField, VLabel } from 'vuetify/src/components'\n\n// Directives\n// import ripple from 'vuetify/src/directives/ripple'\n\n// Utilities\n// import mixins from 'vuetify/src/util/mixins'\n\nconst VStripeInput = {\n  name: 'v-stripe-input',\n  extends: VTextField,\n  // directives: { ripple },\n  inheritAttrs: false,\n  props: {\n    apiKey: {\n      type: String,\n      required: true,\n    },\n    font: {\n      type: String,\n      default: 'Roboto',\n    },\n    zip: {\n      type: String,\n      default: '',\n    },\n    // appendOuterIcon: String,\n    autofocus: Boolean,\n    // clearable: Boolean,\n    // clearIcon: {\n    //   type: String,\n    //   default: '$vuetify.icons.clear'\n    // },\n    // filled: Boolean,\n    // flat: Boolean,\n    // fullWidth: Boolean,\n    // label: String,\n    // outlined: Boolean,\n    // placeholder: String,\n    // prefix: String,\n    // prependInnerIcon: String,\n    // reverse: Boolean,\n    // rounded: Boolean,\n    // shaped: Boolean,\n    // singleLine: Boolean,\n    // solo: Boolean,\n    // soloInverted: Boolean,\n    // suffix: String,\n  },\n  data: () => ({\n    card: null,\n    cardError: null,\n    elements: null,\n    okToSubmit: false,\n    stripe: null,\n  }),\n  computed: {\n    classes (): object {\n      return {\n        ...VTextField.options.computed.classes.call(this),\n        'v-stripe-input': true,\n      }\n    },\n  },\n  // watch: {},\n  created () {\n  },\n  mounted () {\n    // Handle tasks NOT related to actual DOM rendering or manipulation\n    const self = this\n    const style = this.genStyle(this.font, this.$vuetify.theme.currentTheme, this.$vuetify.theme.dark)\n    const classes = { focus: 'focus', empty: 'empty' }\n    const cardProps = { style, classes, value: { postalCode: this.zip, label: 'x' } }\n    self.loading = true\n    this.loadStripe()\n      // initialize the Stripe.js object\n      // @ts-ignore\n      .then(() => Stripe(self.apiKey)) // eslint-disable-line no-undef\n      // then create a Stripe elements generator\n      .then(stripe => stripe.elements(self.genFont(self.font)))\n      // then create a card element\n      .then(elements => elements.create('card', cardProps))\n      // then setup card events and return the card\n      .then(card => {\n        card.on('blur', self.onBlur)\n        card.on('focus', self.onFocus)\n        card.on('ready', e => { self.autofocus && card.focus(); self.$emit('ready', e) })\n        card.on('change', e => {\n          e.error && self.errorBucket.push(e.error.message)\n          e.complete && (self.errorBucket = []) // won't work if there are external rules\n        })\n        return card\n      })\n      .then(card => {\n        card.mount(`#${self.computedId}`)\n        // console.log(card)\n        self.card = card\n        self.loading = false\n      })\n      .catch(err => { console.log(err) })\n  },\n  methods: {\n    genFont: font => ({ fonts: [{ cssSrc: `https://fonts.googleapis.com/css?family=${encodeURI(font)}:400` }] }),\n    // see: https://stripe.com/docs/stripe-js/reference#element-mount\n    // All we need is a <div> with a known ID. This <div> will get\n    // replaced by Stripe with an IFrame with their custom inputs.\n    genInput () {\n      return this.$createElement('div', { attrs: { id: this.computedId } })\n    },\n    genStyle: (font: String, theme: VuetifyThemeVariant, dark = false) => ({\n      base: {\n        color: dark ? '#ffffff' : '#000000',\n        fontFamily: `'${font}', sans-serif`,\n        fontSize: '16px',\n        fontSmoothing: 'antialiased',\n        '::placeholder': {\n          color: dark ? 'rgb(255,255,255,0.7)' : 'rgb(0,0,0,0.54)',\n        },\n        ':focus::placeholder': {\n          color: dark ? 'rgb(255,255,255,0.7)' : 'rgb(0,0,0,0.54)',\n        },\n      },\n      invalid: {\n        color: theme.error,\n        iconColor: theme.error,\n      },\n    }),\n    loadStripe (): Promise<Boolean|Error> {\n      // is Stripe already available?\n      if (typeof Stripe !== 'undefined') return Promise.resolve(true)\n      // is the external script loader available?\n      if (typeof this.$loadScript === 'undefined') {\n        // no\n        throw new Error('[VStripeInput Error]: Stripe is not available and could not be loaded. Please make sure that you have installed and configured all of the necessary dependencies to use this component.')\n      } else {\n        // yes, let's try to get Stripe\n        return this.$loadScript('https://js.stripe.com/v3/')\n          .then(() => true)\n          .catch((err: Error) => {\n            throw new Error('[VStripeInput Error] There was a problem loading Stripe: ' + err.message)\n          })\n      }\n    },\n    onBlur (e) {\n      this.isFocused = false\n      e && this.$emit('blur', e)\n    },\n    onClick () {\n      if (this.isFocused || this.disabled) return\n      this.card.focus()\n    },\n    onFocus (e) {\n      if (!this.isFocused) {\n        this.isFocused = true\n        e && this.$emit('focus', e)\n      }\n    },\n  },\n}\n\nexport default VStripeInput\n"],"sourceRoot":"","file":"VStripeInput.js"}